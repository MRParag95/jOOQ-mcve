DROP SCHEMA IF EXISTS mcve CASCADE;

CREATE SCHEMA mcve;

-- Used in mcveTest()
create table mcve.test
(
    id INT NOT NULL GENERATED ALWAYS AS IDENTITY,
    cd INT,
    CONSTRAINT pk_test PRIMARY KEY (id)
);

-- Referenced by multiple tables (Attendance, Safety Officials, etc.)
create table mcve.t_users
(
    id bigserial primary key
);

-- Used in implicitJoinBug for .meetingType()
create table mcve.meeting_type
(
    id           bigserial primary key,
    abbreviation varchar(20)
);

-- Used in implicitJoinBug for .safetyOfficial()
create table mcve.safety_official
(
    id bigserial primary key
);

-- The main table used in implicitJoinBug
create table mcve.meeting_minutes
(
    id                      bigserial primary key,
    meeting_date            timestamp(6) with time zone,
    is_active               boolean default true,
    meeting_approval_status varchar(255),
    meeting_type_id         bigint
        constraint fk_meeting_type_id references mcve.meeting_type
);

-- Many-to-Many link required for .safetyOfficial() traversal
create table mcve.meeting_minutes_safety_official
(
    meeting_minutes_id bigint not null
        constraint fk_meeting_minutes_id references mcve.meeting_minutes,
    safety_official_id bigint not null
        constraint fk_safety_official_id references mcve.safety_official,
    primary key (meeting_minutes_id, safety_official_id)
);

-- Used for .employeeSafetyOfficials()
create table mcve.employee_safety_officials
(
    id                  bigserial primary key,

    -- PRIMARY FK (Used in Java)
    employee_id         bigint not null
        constraint fkrc0334eor9ddu84fee889e2wt references mcve.t_users,

    -- DUMMY FK (Added to force jOOQ to keep the specific name for the FK above)
    created_by_id       bigint
        constraint fk_eso_dummy_ambiguity references mcve.t_users,

    safety_officials_id bigint not null
        constraint fkt2djpxywqe1tx2ox7w9mpo200 references mcve.safety_official,
    position            varchar(255)
);

-- Used for .meetingAttendance()
create table mcve.meeting_attendance
(
    id                 bigserial primary key,

    -- PRIMARY FK (Used in Java)
    emp_id             bigint
        constraint fk45wm9ak3urnj55wmt7bpdilag references mcve.t_users,

    -- DUMMY FK (Added to force jOOQ to keep the specific name for the FK above)
    created_by_id       bigint
        constraint fk_ma_dummy_ambiguity references mcve.t_users,

    meeting_minutes_id bigint
        constraint fk515akciu5ge2fbwvunrgxdqv1 references mcve.meeting_minutes
);

-- Used for .meetingSagHeadEmp()
create table mcve.meeting_sag_head_emp
(
    meeting_id      bigint not null
        constraint fk_meeting_id references mcve.meeting_minutes,
    sag_head_emp_id bigint not null
        constraint fk_sag_head_emp_id references mcve.t_users,
    primary key (meeting_id, sag_head_emp_id)
);

-- Used for .meetingAgenda()
create table mcve.meeting_agenda
(
    id                 bigserial primary key,
    meeting_minutes_id bigint
        constraint fklp4v63frejr2ej7nmevlyb7yx references mcve.meeting_minutes
);

-- Used for .meetingDecision()
create table mcve.meeting_decision
(
    id        bigserial primary key,
    agenda_id bigint
        constraint fkr119x9oma7wkndxskkbjo6pbr references mcve.meeting_agenda
);

-- Used for .meetingDecisionActionBy()
create table mcve.meeting_decision_action_by
(
    id                  bigserial primary key,
    meeting_decision_id bigint
        constraint fkns3sg7towry7405wyk20vhj0i references mcve.meeting_decision
);